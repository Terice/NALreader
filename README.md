# NALreader
A simple and Incomplete reader for h.264  
by C++  


**Just for learning(=。=)**  
是在我学习过程中所写，基本无实用价值  

## 运行对象
三个主要调用的对象是 Parser Decoder Debug  
### Parser
解析器 parser 用来读取和存储一些句法元素(主要是 SPS PPS )  
cabac 的运行也是在 parser 中完成的  
(cabac 中，为了统一句法元素，多参数句法元素的采用位移的方式制作成一个参数)  
从文件中读取字节的处理由 parser 中的 bitsbuf对象完成  

### Decoder
解码器负责管理缓冲的图像、初始化资源参考表以及参考表  
资源参考表的意思是所有参考帧、长期帧、短期帧三张表  
参考表是指 参考表0、参考表1 两张表  
还放了两个初始矩阵，是在解码的过程中使用的(感觉放在这里不是很合适)  

### Debug
Debug对象用来管理各种信息的打印  
控制符在对应的lua脚本中  
也可以用类似C头文件的格式来读取控制符，  
这个函数在初始化该对象的函数的上面有说明  

### picture
picture 对象存储每一帧的宏块的数据  
picture 对象由 Decoder 对象管理  
解码完成之后的宏块全部都在 picture 中(宏块矩阵的形式)  
(slice 在解码完毕之后就已经释放)  


## 输入和输出
### 输入
输入为h.264的码流文件，  
所使用的函数是C的文件读取函数  
打开在main中，处理在 Parser 对象中  
### 输出
输出为字符画(printf()函数->终端)  
main.cpp 中指明了上面三个对象的使用方法  
输出函数在Decoder中，输出顺序由POC决定，  
输出由一个栈管理按POC递增的顺序输出  
(所以在main中的主循环中的一次输出的帧数量不确定)  


## 未完成的点：  
- 只能用于CABAC的264，不能用于非熵编码的264(也就是存在两个描述子的时候只使用ae描述子)  
- Direct 的时间空间预测全部简化为了空间预测随周围宏块一起运动  
- 只有帧模式，色度模式只用420，只解码亮度(色度只做相应读取没有解码)  
- 解码速度很慢，大概1秒1帧（大哭/(ㄒoㄒ)/~~），  
- 没有做PCM宏块的处理（指PCM宏块数据转换成宏块数据）  
- 没有做后期处理(去方块滤波、裁剪等)  

## 其他  
这个项目是为了学习 C++ 和 h.264 而写，所以强行加入了许多很冗余的方法。  
实现基本是参考 c066069_ISO_IEC_14496-10_2014 而做的。
